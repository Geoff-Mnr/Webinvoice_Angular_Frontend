<form [formGroup]="form" class="relative transform overflow-hidden bg-background shadow-sm ring-1 ring-gray-900/5 sm:rounded-sm md:col-span-2">
  <div class="px-4 py-6 sm:p-8">
    <h2 class="font-montserrat font-semibold text-lg text-secondaryforeground">Données du Document</h2>
    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 pt-6">
      <div class="sm:col-span-4">
        <label for="reference_number" class="block font-montserrat text-sm font-medium leading-6 text-secondaryforeground">Reference</label>
        <div class="mt-2">
          <input
            type="text"
            name="reference_number"
            [(ngModel)]="selectedDocument.reference_number"
            formControlName="reference_number"
            required
            placeholder="Reference"
            class="block w-full rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          />
        </div>
      </div>
      <div class="sm:col-span-3">
        <label for="documenttype_id" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Type de document</label>
        <div class="mt-2">
          <select
            name="documenttype_id"
            formControlName="documenttype_id"
            [(ngModel)]="selectedDocument.documenttype_id"
            class="block w-full rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          >
            <option value="documenttype.id" disabled selected>Choisir le type de document</option>
            @for(documenttype of documenttypes; track documenttype.id) {
            <option [value]="documenttype.id">{{ documenttype.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="customer_id" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Client</label>
        <div class="mt-2">
          <select
            name="customer_id"
            formControlName="customer_id"
            [(ngModel)]="selectedDocument.customer_id"
            class="block w-full rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          >
            <option value="customer.id" disabled selected>Choisir le client</option>
            @for(customer of customers; track customer.id) {
            <option [value]="customer.id">{{ customer.company_name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="sm:col-span-4">
        <label for="product_id" class="block font-montserrat text-sm font-medium leading-6 text-secondaryforeground">Produit</label>
        <div class="mt-2">
          <div class="mt-2">
            <select
              multiple
              name="product_id"
              formControlName="product_id"
              [(ngModel)]="selectedDocument.product_id"
              class="block w-full rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
            >
              <option value="customer.id" disabled selected>Choisir le client</option>
              @for(product of products; track product.id) {
              <option [value]="product.id">{{ product.name }}</option>
              }
            </select>
          </div>
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="document_date" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Date de création</label>
        <div class="mt-2">
          <mat-form-field class="block w-full bg-background text-secondaryforeground">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker1" formControlName="document_date" (dateChange)="dateChanged($event)" />
            <mat-hint>MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="due_date" class="block font-montserrat text-sm font-medium leading-6 text-secondaryforeground">Date d'échéance</label>
        <div class="mt-2">
          <mat-form-field class="block w-full bg-background text-secondaryforeground">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker2" formControlName="due_date" />
            <mat-hint>MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>
      </div>

      <div class="sm:col-span-2">
        <label for="price_htva" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Prix hors TVA</label>
        <div class="mt-2">
          <input
            type="text"
            name="price_htva"
            [(ngModel)]="selectedDocument.price_htva"
            formControlName="price_htva"
            placeholder="Prix hors TVA"
            required
            class="block w-full pl-3 rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          />
        </div>
      </div>

      <div class="sm:col-span-2">
        <label for="price_vvac" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Prix TVAC</label>
        <div class="mt-2">
          <input
            type="text"
            name="price_vvac"
            [(ngModel)]="selectedDocument.price_vvac"
            formControlName="price_vvac"
            placeholder="Prix hors TVA"
            class="block w-full pl-3 rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          />
        </div>
      </div>

      <div class="sm:col-span-2">
        <label for="price_total" class="block text-sm font-montserrat font-medium leading-6 text-secondaryforeground">Prix total</label>
        <div class="mt-2">
          <input
            type="text"
            name="price_total"
            [(ngModel)]="selectedDocument.price_total"
            formControlName="price_total"
            placeholder="Prix total"
            class="block w-full pl-3 rounded-md font-montserrat border-0 py-1.5 text-secondaryforeground shadow-sm ring-1 ring-inset bg-background ring-border placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
          />
        </div>
      </div>
    </div>
  </div>

  <div class="flex items-center justify-end gap-x-6 border-t border-border px-4 py-4 sm:px-8">
    <button type="button" (click)="cancel()" class="text-sm font-semibold font-montserrat leading-6 text-secondaryforeground">Annuler</button>
    @if (selectedDocument.id) {
    <button
      type="submit"
      [disabled]="form.invalid"
      [class.bg-primary]="!form.invalid"
      [class.bg-blue-100]="form.invalid"
      (click)="updateDocument()"
      class="rounded-md bg-primary px-3 py-2 text-sm font-semibold font-montserrat text-secondary shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
    >
      Modifier
    </button>
    } @else {
    <button
      type="submit"
      [disabled]="form.invalid"
      [class.bg-primary]="!form.invalid"
      [class.bg-blue-100]="form.invalid"
      (click)="createDocument()"
      class="rounded-md bg-primary px-3 py-2 text-sm font-semibold font-montserrat text-secondary shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
    >
      Ajouter
    </button>
    }
  </div>
</form>
